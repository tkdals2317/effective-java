# item 71. 필요 없는 검사 예외를 피하라

<aside>
💡 검사 예외를 남발했을 때의 단점과 검사 예외를 회피하는 방법에 대해 알아보자

</aside>

### 검사 예외의 장점과 단점

검사예외는 발생한 문제를 프로그래머가 처리하여 안전성을 높이게끔 해준다.

하지만 너무 과하게 사용한다면 오히려 쓰기 불편한 API가 된다.

더구나 검사 예외를 던지는 메서드는 스트림 안에서 직접 사용 할 수 없으므로 자바 8부터는 더 쓰기 힘들어졌다.

API를 제대로 사용해도 발생할 수 있는 예외이거나, 프로그래머가 의미있는 조치를 취할 수 있는 경우라면 검사 예외를 사용해도 되지만, 

둘 중 어디에도 해당하지 않는다면 비검사 예외를 사용하는 것이 좋다.

검사 예외와 비검사 예외 중 어느 것을 선택해야 할지는 프로그래머가 그 예외를 어떻게 다룰지 생각해보면 알 수 있다.

```java
try {
    methodThrowCheckedException();
} catch (TheCheckedException e) {
    throw new AssertionError(e);
}
```

과

```java
try {
    methodThrowCheckedException();
} catch (TheCheckedException e) {
    e.printStackTrace(); // 이런, 우리가 졌다.
    System.exit(1);
}
```

더 나은 방법이 없다면 비검사 예외를 선택해야 한다.

검사 예외가 프로그래머에게 지우는 부담은 메서드가 단 하나의 검사 예외만 던질 때가 특히 크다.

이미 다른 검사예외도 던지는 상황에서 또 다른 검사 예외를 추가하는 경우라면 catch문 하나를 추가하는 선에서 끝난다.

하지만 검사 예외가 단 하나 뿐이라면 오직 그 예외 때문에 API 사용자는 try 블록을 추가해야하고 스트림에서도 직접 사용하지 못하게 되버린다.

그래서 이런 경우에는 검사 예외를 안 던지는 방법이 없는지 고민해볼 가치가 있다.

### 검사 예외를 회피하는 방법

1. **적절한 결과 타입을 담은 빈 옵셔널을 반환하는 방법**
    
    검사 예외를 던지는 대신 단순히 빈 옵셔널을 반환하면 된다.
    
    단점은 예외가 발생한 이유를 알려주는 부가 정보를 담을 수 없다는 것 이다.
    

1. **검사 예외를 던지는 메서드를 2개로 쪼개 비검사 예외로 바꾸는 방법**
    
    첫번 째 메서드는 예외가 던져질지 여부를 boolean 값으로 반환한다.
    
    ```java
    // 코드 71-1 검사예외를 던지는 메서드 - 리팩터링 전
    try {
        obj.action();
    } catch (TheCheckedException e) {
        // 예외 상황을 대처한다.
        throw new RuntimeException(e);
    }
    
    // 코드 72-2 상태 검사 메서드와 비검사 예외를 던지는 메서드 - 리팩터링 후
    if (obj2.actionPermitted()) {
        obj2.action();
    } else {
        // 예외 상황을 대처한다.
    }
    ```
    
    모든 상황에 적용할 수는 없지만 적용할 수만 있다면 쓰기 편한 API를 만들 수 있다.
    
    actionPermitted는 상태 검사 메서드에 해당하므로 아이템 69에서 말한 단점도 그대로 적용되니 주의해야 한다.
    
    즉, 외부 동기화 없이 여러 스레드가 동시에 접근할 수 있거나 외부 요인에 의해 상태가 변할 수 있다면 이 리팩토링은 적절하지 않을 수 있다.
    
    actionPermitted와 action 호출 사이에 객체의 상태가 변할 수 있기 때문이다.
    
    또한 actionPermitted과 action 메서드의 작업 일부를 중복 수행한다면 성능에서 손해이다.
    
2. 프**로그래머가 이 메서드가 성공하리란 걸 안다거나, 실패시 스레드를 중단하길 원한다면 그냥 사용해도 무방하다.**
    
    ```java
    obj.action(arg);
    ```
    
    이 한줄짜리 호출 방식이 주로 쓰일 거로 판단되면 2번 방식으로 리팩터링하는 편이 바람직하다.
    

### 정리

꼭 필요한 곳에만 사용한다면 검사 예외는 프로그램의 안전성을 높여주지만, 남용하면 쓰기 힘든 API를 만들게 된다.

API 호출자가 예외 상황에서 복구할 방법이 없다면 비검사 예외를 던지자

복구 가능하고 그 처리를 해주길 바란다면, 우선 옵셔널을 반환해도 될 지 고민해보자.

옵셔널만으로 처리하기에 충분한 정보를 제공할 수 없을 때만 검사 예외를 사용하자.

왠만해서는 검사예외보다는 비검사 예외를 쓰는 게 좋아보인다.