# item 21. μΈν„°νμ΄μ¤λ” κµ¬ν„ν•λ” μ½μ„ μƒκ°ν•΄ μ„¤κ³„ν•λΌ

<aside>
π’΅ μΈν„°νμ΄μ¤ λ””ν΄νΈ λ©”μ„λ“μ— λ€ν•΄ μ•μ•„λ³΄κ³  λ””ν΄νΈ λ©”μ„λ“λ¥Ό μ‚¬μ©ν•  μ‹ λ¬Έμ μ λ„ μ•μ•„λ³΄μ

</aside>

### μ λ©μ„ λ³΄λ©΄μ„ λ“¤μ€ μƒκ°

μΈν„°νμ΄μ¤λ” κµ¬ν„ν•λ” μ½? μ—¬κΈ°μ„ κµ¬ν„ν•λ” μ½μ΄λΌλ” κ±΄ λ­κΉ?

λ§μ΄ λ„λ¬΄ μ–΄λ µλ‹¤β€¦ 

### λ””ν΄νΈ λ©”μ„λ“

μ΄ μ¥μ„ μ΄ν•΄ν•κΈ° μ„ν•΄μ„λ” λ””ν΄νΈ λ©”μ„λ“κ°€ μ •ν™•ν μ–΄λ–¤ μ—­ν• μ„ ν•λ” κ±΄μ§€ μ•κ³  μ§€λ‚κ°€μ•Ό ν•  κ²ƒ κ°™μ•„

λ””ν΄νΈ λ©”μ„λ“μ— λ€ν•΄ μ •λ¦¬ν•΄λ΄¤λ‹¤.

μλ°” 7κΉμ§€λ” μΌλ°μ μΌλ΅ μΈν„°νμ΄μ¤μ λ©”μ„λ“λ” κµ¬ν„ λ€μ‹  μ„ μ–Έλ§ ν•΄λ†“κ³  μ΄ μΈν„°νμ΄μ¤λ¥Ό implementsν• ν΄λμ¤μ—μ„ κ·Έ λ©”μ„λ“λ¥Ό κµ¬ν„ν•  μ μκ² λμμ—λ‹¤.

β‡’ μλ°” 7κΉμ§€λ” μΈν„°νμ΄μ¤μ— κµ¬ν„ν• λ©”μ„λ“κ°€ μμΌλ©΄ μ»΄νμΌ μ¤λ¥κ°€ λ‚¬μ

ν•μ§€λ§ μλ°” 8 μ΄ν›„λ΅λ” λ””ν΄νΈ λ©”μ„λ“κ°€ μ¶”κ°€λλ©΄μ„ μΈν„°νμ΄μ¤μ—μ„λ„ λ©”μ„λ“λ¥Ό κµ¬ν„ν•  μ μκ² λ°”λ€μ—λ‹¤.

κ·Έλ¦¬κ³  μ΄ λ””ν΄νΈ λ©”μ„λ“λ” κµ¬ν„μ²΄μ—μ„ overrideλ¥Ό ν•μ—¬ μ¬μ •μλ¥Ό ν•  μλ„ μλ‹¤.

**λ””ν΄νΈ λ©”μ„λ“μ ν•„μ”μ„±**

- λ‹¨μν™”
    
    κ³µν†µμ μΌλ΅ μ‚¬μ©λλ” λ©”μ„λ“λ” μΈν„°νμ΄μ¤μ—μ„ κΈ°λ³Έ λ©”μ„λ“λ΅ μ •μν•λ©΄ λ” μ΄μƒ ν΄λμ¤μ—μ„ μ¶”μƒ λ©”μ„λ“λ¥Ό κµ¬ν„ν•μ§€ μ•μ•„λ„ λλ‹¤. κ·Έλ΅ μΈν•΄ λ¶ν•„μ”ν• μ‘μ—…μ€ μ¤„μ΄κ³  κ°λ° μ†λ„λ” λ†’μ•„μ§€λ―€λ΅ μ‘μ—…μ΄ λ‹¨μν™”ν•  μ μλ‹¤.
    
- λλ‹¤μ‹
    
    Java 8 μ΄μ „μ—λ” μ»¬λ ‰μ… κ°μ²΄λ¥Ό μνν•΄μ•Ό ν•λ” κ²½μ° λ°λ³µμ(Iterator) κ°μ²΄λ¥Ό μƒμ„±ν•κ³  hasNext() λ©”μ„λ“λ¥Ό μ‚¬μ©ν–μµλ‹λ‹¤. λ‹¤μ μμ λ” μ»¬λ ‰μ… κ°μ²΄λ¥Ό μνν•λ” κ°€μ¥ μΌλ°μ μΈ λ°©λ²•μ΄λ‹¤.
    
    ```java
    ArrayList aList = new ArrayList<String>();
    aList.add("One");
    aList.add("Two");
    aList.add("Three");
    
    // iterator() λ©”μ„λ“λ¥Ό νΈμ¶ν•μ—¬ Iterator κ°μ²΄λ¥Ό κ°€μ Έμµλ‹λ‹¤.
    Iterator iterator = aList.iterator();
    
    // hasNext() λ©”μ„λ“λ¥Ό μ‚¬μ©ν•μ—¬ μ»¬λ ‰μ… κ°μ²΄λ¥Ό μνν•©λ‹λ‹¤.while( iterator.hasNext() ){
    // next() λ©”μ„λ“λ¥Ό μ‚¬μ©ν•μ—¬ μ»¬λ ‰μ… κ°μ²΄μ ν„μ¬ μ”μ†λ¥Ό κ°€μ Έμµλ‹λ‹¤.
      System.out.println( iterator.next() );
    }
    ```
    
    μ΄μ  μ„ μμ μ²λΌ λ°λ³µμ κ°μ²΄λ¥Ό μƒμ„±ν•μ§€ μ•μ•„λ„ λ©λ‹λ‹¤. Java 8λ¶€ν„° Iterable μΈν„°νμ΄μ¤μ— forEach() κΈ°λ³Έ λ©”μ„λ“κ°€ μ¶”κ°€λμ—κΈ° λ•λ¬Έμ…λ‹λ‹¤.
    
    Iterable μΈν„°νμ΄μ¤μ forEach() λ©”μ„λ“λ¥Ό μ‚¬μ©ν•μ—¬ μ„ μ†μ¤μ½”λ“λ¥Ό κ°„κ²°ν•κ² λ§λ“¤ μ μμµλ‹λ‹¤.
    
    ```java
    public class Main {
    Β Β public static void main(String args[]) {
        ArrayList aList = new ArrayList<String>();
        aList.add("One");
        aList.add("Two");
        aList.add("Three");
    
        aList.forEach((item) -> System.out.println(item));
    Β Β }
    }
    ```
    
    μλ£ μ¶μ² : 
    
    [[Java]κΈ°λ³Έ λ©”μ„λ“ λλ” λ””ν΄νΈ λ©”μ„λ“(Default Method)](https://developer-talk.tistory.com/463)
    

### λ¨λ“  μƒν™©μ—μ„ λ¶λ³€μ‹μ„ ν•΄μΉμ§€ μ•λ” λ””ν΄νΈ λ©”μ„λ“λ¥Ό μ‘μ„±ν•κΈ°λ” μ–΄λ µλ‹¤

μ•„λ¬΄λ¦¬ λ²”μ©μ μΌλ΅ λ§λ“  λ””ν΄νΈ λ©”μ„λ“λΌλ„ μμ™Έκ°€ λ°μƒν•  μ μλ‹¤.

λ€ν‘μ μΈ μλ΅ Collection μΈν„°νμ΄μ¤μ— μ¶”κ°€λ removeIf λ©”μ„λ“κ°€ μλ‹¤.

```java
default boolean removeIf(Predicate<? super E> filter) {
    Objects.requireNonNull(filter);
    boolean removed = false;
    final Iterator<E> each = iterator();
    while (each.hasNext()) {
        if (filter.test(each.next())) {
            each.remove();
            removed = true;
        }
    }
    return removed;
}
```

μ„ removeIf λ©”μ„λ“λ” λ§¤μ° λ²”μ©μ μΈ λ©”μ„λ“μ΄μ§€λ§ κ·Έλ ‡λ‹¤κ³  λ¨λ“  Collection κµ¬ν„μ²΄μ™€ μ μ–΄μ°λ¬μ§€λ” κ²ƒμ€ μ•„λ‹λ‹¤.

`org.apache.commons.collections4.collection.SynchronizedCollection` μ Collection κµ¬ν„μ²΄λ” ν΄λΌμ΄μ–ΈνΈκ°€ μ κ³µν• κ°μ²΄λ΅ λ½μ„ κ±°λ” λ¥λ ¥μ„ μ¶”κ°€λ΅ μ κ³µν•λ‹¤.

μ¦‰, λ¨λ“  λ©”μ„λ“μ—μ„ μ£Όμ–΄μ§„ λ½ κ°μ²΄λ¥Ό λ™κΈ°ν™”ν• ν›„ λ‚΄λ¶€ μ»¬λ ‰μ… κ°μ²΄μ— κΈ°λ¥μ„ μ„μ„ν•λ” λνΌ ν΄λμ¤μ΄λ‹¤.

λ””ν΄νΈ λ©”μ„λ“λ΅ κµ¬ν„λ CollectionμΈν„°νμ΄μ¤μ removeIfμ κµ¬ν„μ€ λ™κΈ°ν™”μ— κ΄€ν•΄ μ•„λ¬΄κ²ƒλ„ λ¨λ¥΄λ―€λ΅ λ½ κ°μ²΄λ¥Ό μ‚¬μ©ν•  μ μ—†λ‹¤.

κ·Έ κ²°κ³Ό μ—¬λ¬ μ¤λ λ“κ°€ κ³µμ ν•λ” ν™κ²½μ—μ„ ν• μ¤λ λ“κ°€ removeIfλ¥Ό νΈμ¶ν•λ©΄ `ConcurrentModificationException` λ¥Ό λ°μƒν•κ±°λ‚ λ‹¤λ¥Έ μκΈ°μΉ λ»ν• κ²°κ³Όλ΅ μ΄μ–΄μ§ μ μλ‹¤.

**ν•΄κ²°μ±…**

μλ°” ν”λ«νΌ λΌμ΄λΈλ¬λ¦¬μ—μ„λ„ μ΄λ° λ¬Έμ λ¥Ό μλ°©ν•κΈ° μ„ν•΄ μΌλ ¨μ μ΅°μΉλ¥Ό μ·¨ν–λ‹¤.

μλ¥Ό λ“¤μ–΄ κµ¬ν„ν• μΈν„°νμ΄μ¤μ λ””ν΄νΈ λ©”μ„λ“λ¥Ό μ •μν•κ³ , λ‹¤λ¥Έ λ©”μ„λ“μ—μ„λ” λ””ν΄νΈ λ©”μ„λ“λ¥Ό νΈμ¶ν•κΈ° μ „μ— ν•„μ”ν• μ‘μ—…μ„ μν–‰ν•λ„λ΅ ν–λ‹¤.

Collections.synchronizedCollectionμ„ λ°ν™ν•λ” package-private ν΄λμ¤λ“¤μ€ removeIfλ¥Ό **μ¬μ •μ**ν•κ³ , **μ΄λ¥Ό νΈμ¶ν•λ” λ‹¤λ¥Έ λ©”μ„λ“λ“¤μ€ λ””ν΄νΈ κµ¬ν„μ„ νΈμ¶ν•κΈ° μ „μ— λ™κΈ°ν™”λ¥Ό ν•λ„λ΅ ν–λ‹¤**.

```java
static class SynchronizedCollection<E> implements Collection<E>, Serializable {
        ...
        @Override
        public boolean removeIf(Predicate<? super E> filter) {
            synchronized (mutex) {return c.removeIf(filter);}
        }
        ...
    }
```

ν•μ§€λ§ μλ°” ν”λ«νΌμ— μ†ν•μ§€ μ•μ€ μ  3μ μ»¬λ ‰μ… κµ¬ν„μ²΄λ“¤μ€ μ΄λ° μ–Έμ–΄ μ°¨μ›μ μΈν„°νμ΄μ¤ λ³€ν™”μ— λ°λ§μ¶° μμ •λ  κΈ°νκ°€ μ—†μ—μΌλ©°, κ·Έμ¤‘ μΌλ¶€λ” μ—¬μ „ν μμ •λκ³  μμ§€ μ•λ‹¤.(ex. `org.apache.commons.collections4.collection.SynchronizedCollection` )

### λ””ν΄νΈ λ©”μ„λ“λ” μ»΄νμΌμ— μ„±κ³µν•λ”λΌλ„ κΈ°μ΅΄ κµ¬ν„μ²΄μ— λ°νƒ€μ„ μ¤λ¥λ¥Ό μΌμΌν‚¬ μ μλ‹¤.

κΈ°μ΅΄ μΈν„°νμ΄μ¤μ— λ””ν΄νΈ λ©”μ„λ“λ΅ μƒ λ©”μ„λ“λ¥Ό μ¶”κ°€ν•λ” μΌμ€ κΌ­ ν•„μ”ν• κ²½μ°κ°€ μ•„λ‹λ©΄ ν”Όν•΄μ•Όν•λ‹¤.

λ””ν΄νΈ λ©”μ„λ“κ°€ κΈ°μ΅΄ κµ¬ν„μ²΄λ“¤κ³Ό μ¶©λν•  μ μκΈ° λ•λ¬Έμ΄λ‹¤.

κ·Έλ¦¬κ³  λ””ν΄νΈ λ©”μ„λ“λ” μΈν„°νμ΄μ¤λ΅λ¶€ν„° λ©”μ„λ“λ¥Ό μ κ±°ν•κ±°λ‚ κΈ°μ΅΄ λ©”μ„λ“μ μ‹κ·Έλ‹μ²λ¥Ό μμ •ν•λ” μ©λ„κ°€ μ•„λ‹μ„ λ…μ‹¬ν•΄μ•Ό ν•λ‹¤.

### μ •λ¦¬

λ””ν΄νΈ λ©”μ„λ“λΌλ” λ„κµ¬κ°€ μƒκ²Όλ”λΌλ„ λ‚¨λ°ν•μ§€λ§κ³  μΈν„°νμ΄μ¤λ¥Ό μ„¤κ³„ν•  λ•λ” μ„Έμ‹¬ν• μ£Όμλ¥Ό κΈ°μΈμ΄μ